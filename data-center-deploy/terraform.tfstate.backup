{
  "version": 4,
  "terraform_version": "0.12.24",
  "serial": 477,
  "lineage": "3a07def1-fee2-71a1-b007-d56816b907a5",
  "outputs": {},
  "resources": [
    {
      "mode": "managed",
      "type": "google_compute_address",
      "name": "centos-ip-address",
      "provider": "provider.google",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "address": "10.20.0.4",
            "address_type": "INTERNAL",
            "creation_timestamp": "2021-02-22T13:13:14.425-08:00",
            "description": "",
            "id": "projects/todo-er/regions/europe-west1/addresses/centos-ip-address",
            "name": "centos-ip-address",
            "network_tier": "PREMIUM",
            "project": "todo-er",
            "purpose": "GCE_ENDPOINT",
            "region": "europe-west1",
            "self_link": "https://www.googleapis.com/compute/v1/projects/todo-er/regions/europe-west1/addresses/centos-ip-address",
            "subnetwork": "https://www.googleapis.com/compute/v1/projects/todo-er/regions/europe-west1/subnetworks/subnet-europe-west1",
            "timeouts": null,
            "users": []
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoyNDAwMDAwMDAwMDAsImRlbGV0ZSI6MjQwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "google_compute_network.puppet-course-net",
            "google_compute_subnetwork.subnet-europe-west1"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "google_compute_address",
      "name": "jenkins-server-ip",
      "provider": "provider.google",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "address": "10.30.0.7",
            "address_type": "INTERNAL",
            "creation_timestamp": "2021-02-22T13:13:25.178-08:00",
            "description": "",
            "id": "projects/todo-er/regions/europe-west2/addresses/jenkins-server-ip",
            "name": "jenkins-server-ip",
            "network_tier": "PREMIUM",
            "project": "todo-er",
            "purpose": "GCE_ENDPOINT",
            "region": "europe-west2",
            "self_link": "https://www.googleapis.com/compute/v1/projects/todo-er/regions/europe-west2/addresses/jenkins-server-ip",
            "subnetwork": "https://www.googleapis.com/compute/v1/projects/todo-er/regions/europe-west2/subnetworks/subnet-europe-west2",
            "timeouts": null,
            "users": []
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoyNDAwMDAwMDAwMDAsImRlbGV0ZSI6MjQwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "google_compute_network.puppet-course-net",
            "google_compute_subnetwork.subnet-europe-west2"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "google_compute_address",
      "name": "master-ip-address",
      "provider": "provider.google",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "address": "10.20.0.2",
            "address_type": "INTERNAL",
            "creation_timestamp": "2021-02-22T13:13:14.428-08:00",
            "description": "",
            "id": "projects/todo-er/regions/europe-west1/addresses/master-ip-address",
            "name": "master-ip-address",
            "network_tier": "PREMIUM",
            "project": "todo-er",
            "purpose": "GCE_ENDPOINT",
            "region": "europe-west1",
            "self_link": "https://www.googleapis.com/compute/v1/projects/todo-er/regions/europe-west1/addresses/master-ip-address",
            "subnetwork": "https://www.googleapis.com/compute/v1/projects/todo-er/regions/europe-west1/subnetworks/subnet-europe-west1",
            "timeouts": null,
            "users": []
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoyNDAwMDAwMDAwMDAsImRlbGV0ZSI6MjQwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "google_compute_network.puppet-course-net",
            "google_compute_subnetwork.subnet-europe-west1"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "google_compute_address",
      "name": "ubuntu-ip-address",
      "provider": "provider.google",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "address": "10.20.0.3",
            "address_type": "INTERNAL",
            "creation_timestamp": "2021-02-22T13:13:14.425-08:00",
            "description": "",
            "id": "projects/todo-er/regions/europe-west1/addresses/ubuntu-ip-address",
            "name": "ubuntu-ip-address",
            "network_tier": "PREMIUM",
            "project": "todo-er",
            "purpose": "GCE_ENDPOINT",
            "region": "europe-west1",
            "self_link": "https://www.googleapis.com/compute/v1/projects/todo-er/regions/europe-west1/addresses/ubuntu-ip-address",
            "subnetwork": "https://www.googleapis.com/compute/v1/projects/todo-er/regions/europe-west1/subnetworks/subnet-europe-west1",
            "timeouts": null,
            "users": []
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoyNDAwMDAwMDAwMDAsImRlbGV0ZSI6MjQwMDAwMDAwMDAwfX0=",
          "dependencies": [
            "google_compute_network.puppet-course-net",
            "google_compute_subnetwork.subnet-europe-west1"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "google_compute_firewall",
      "name": "puppet-course-firwall",
      "provider": "provider.google",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "allow": [
              {
                "ports": [
                  "22",
                  "80",
                  "8080",
                  "3001",
                  "8140"
                ],
                "protocol": "tcp"
              },
              {
                "ports": [],
                "protocol": "icmp"
              }
            ],
            "creation_timestamp": "2021-02-22T13:13:02.765-08:00",
            "deny": [],
            "description": "",
            "destination_ranges": [],
            "direction": "INGRESS",
            "disabled": false,
            "enable_logging": null,
            "id": "projects/todo-er/global/firewalls/puppet-course-firewall",
            "log_config": [],
            "name": "puppet-course-firewall",
            "network": "https://www.googleapis.com/compute/v1/projects/todo-er/global/networks/puppet-course-net",
            "priority": 1000,
            "project": "todo-er",
            "self_link": "https://www.googleapis.com/compute/v1/projects/todo-er/global/firewalls/puppet-course-firewall",
            "source_ranges": [
              "0.0.0.0/0"
            ],
            "source_service_accounts": null,
            "source_tags": null,
            "target_service_accounts": null,
            "target_tags": null,
            "timeouts": null
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoyNDAwMDAwMDAwMDAsImRlbGV0ZSI6MjQwMDAwMDAwMDAwLCJ1cGRhdGUiOjI0MDAwMDAwMDAwMH0sInNjaGVtYV92ZXJzaW9uIjoiMSJ9",
          "dependencies": [
            "google_compute_network.puppet-course-net"
          ]
        }
      ]
    },
    {
      "module": "module.puppet-host-ubuntu",
      "mode": "managed",
      "type": "google_compute_instance",
      "name": "vm_instance",
      "provider": "provider.google",
      "instances": [
        {
          "schema_version": 6,
          "attributes": {
            "allow_stopping_for_update": null,
            "attached_disk": [],
            "boot_disk": [
              {
                "auto_delete": true,
                "device_name": "persistent-disk-0",
                "disk_encryption_key_raw": "",
                "disk_encryption_key_sha256": "",
                "initialize_params": [
                  {
                    "image": "https://www.googleapis.com/compute/v1/projects/ubuntu-os-cloud/global/images/ubuntu-1804-bionic-v20210211",
                    "labels": {},
                    "size": 10,
                    "type": "pd-standard"
                  }
                ],
                "kms_key_self_link": "",
                "mode": "READ_WRITE",
                "source": "https://www.googleapis.com/compute/v1/projects/todo-er/zones/europe-west1-d/disks/puppet-host-ubuntu"
              }
            ],
            "can_ip_forward": false,
            "cpu_platform": "Intel Haswell",
            "current_status": "RUNNING",
            "deletion_protection": false,
            "description": "",
            "desired_status": null,
            "enable_display": false,
            "guest_accelerator": [],
            "hostname": "",
            "id": "projects/todo-er/zones/europe-west1-d/instances/puppet-host-ubuntu",
            "instance_id": "5578801305362210969",
            "label_fingerprint": "42WmSpB8rSM=",
            "labels": null,
            "machine_type": "n1-standard-1",
            "metadata": null,
            "metadata_fingerprint": "sCZh6wF1fcc=",
            "metadata_startup_script": "#! /bin/bash\n\nwget https://apt.puppetlabs.com/puppet-release-bionic.deb;\ndpkg -i puppet-release-bionic.deb;\napt update;\napt install puppet-agent -y;\necho \"export PATH=/opt/puppetlabs/bin:$PATH\" \u003e\u003e ~/.profile\nsource ~/.profile;\necho '10.20.0.2   puppet' \u003e\u003e /etc/hosts\npuppet config set server 'puppet' --section main;\npuppet resource service puppet ensure=running enable=true;\n\n\nuntil curl http://10.20.0.2; do echo waiting for master to be ready; sleep 3; done\n# until nslookup puppet; do echo waiting for myservice; sleep 3; done\npuppet agent -t;\n\napt install nginx -y;\nsystemctl enable --now nginx;\nsleep 60s;\npuppet agent -t;\nsystemctl status vsftpdd;\n\napt install ansible -y;\nuseradd -G admin ansible -m;\necho \"ansible:ansible\" | chpasswd;\n# echo ansible | passwd --stdin ansible; # works on centos\nsed -i 's/PasswordAuthentication yes/PasswordAuthentication no/' /etc/ssh/sshd_config;\n\nmkdir /home/ansible/.ssh;\ntouch /home/ansible/.ssh/authorized_keys;\nchmod 600 /home/ansible/.ssh/authorized_keys;\nchmod 700 /home/ansible/.ssh;\nchown ansible /home/ansible/.ssh;\nchown ansible /home/ansible/.ssh/authorized_keys;\n\n\nif [ $(hostname) == jenkins-server ]; then\n#   apt install java-1.8.0 -y;\n#  wget -q -O - https://pkg.jenkins.io/debian-stable/jenkins.io.key | sudo apt-key add -\n#  deb https://pkg.jenkins.io/debian-stable binary/\n#  apt-get update\n#  apt-get install jenkins\n#  apt install postgresql -y # needed to connect to db during test\n#  systemctl enable jenkins;\n#  systemctl start jenkins;\n  apt install default-jdk -y\n  apt install wget -y\n  wget -q -O - https://pkg.jenkins.io/debian/jenkins.io.key | sudo apt-key add -\n  sh -c 'echo deb http://pkg.jenkins.io/debian-stable binary/ \u003e /etc/apt/sources.list.d/jenkins.list'\n  cat /etc/apt/sources.list.d/jenkins.list\n  apt-get update;\n  apt install jenkins -y;\n  echo \"Initial admin password is $(sudo cat /var/lib/jenkins/secrets/initialAdminPassword)\"\nfi\n",
            "min_cpu_platform": "",
            "name": "puppet-host-ubuntu",
            "network_interface": [
              {
                "access_config": [
                  {
                    "nat_ip": "104.155.70.114",
                    "network_tier": "PREMIUM",
                    "public_ptr_domain_name": ""
                  }
                ],
                "alias_ip_range": [],
                "name": "nic0",
                "network": "https://www.googleapis.com/compute/v1/projects/todo-er/global/networks/puppet-course-net",
                "network_ip": "10.20.0.3",
                "subnetwork": "https://www.googleapis.com/compute/v1/projects/todo-er/regions/europe-west1/subnetworks/subnet-europe-west1",
                "subnetwork_project": "todo-er"
              }
            ],
            "project": "todo-er",
            "resource_policies": null,
            "scheduling": [
              {
                "automatic_restart": true,
                "node_affinities": [],
                "on_host_maintenance": "MIGRATE",
                "preemptible": false
              }
            ],
            "scratch_disk": [],
            "self_link": "https://www.googleapis.com/compute/v1/projects/todo-er/zones/europe-west1-d/instances/puppet-host-ubuntu",
            "service_account": [],
            "shielded_instance_config": [
              {
                "enable_integrity_monitoring": true,
                "enable_secure_boot": false,
                "enable_vtpm": true
              }
            ],
            "tags": null,
            "tags_fingerprint": "42WmSpB8rSM=",
            "timeouts": null,
            "zone": "europe-west1-d"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH0sInNjaGVtYV92ZXJzaW9uIjoiNiJ9",
          "dependencies": [
            "google_compute_address.ubuntu-ip-address",
            "google_compute_network.puppet-course-net",
            "google_compute_subnetwork.subnet-europe-west1"
          ]
        }
      ]
    },
    {
      "module": "module.puppet-master",
      "mode": "managed",
      "type": "google_compute_instance",
      "name": "vm_instance",
      "provider": "provider.google",
      "instances": [
        {
          "schema_version": 6,
          "attributes": {
            "allow_stopping_for_update": null,
            "attached_disk": [],
            "boot_disk": [
              {
                "auto_delete": true,
                "device_name": "persistent-disk-0",
                "disk_encryption_key_raw": "",
                "disk_encryption_key_sha256": "",
                "initialize_params": [
                  {
                    "image": "https://www.googleapis.com/compute/v1/projects/centos-cloud/global/images/centos-8-v20210217",
                    "labels": {},
                    "size": 20,
                    "type": "pd-standard"
                  }
                ],
                "kms_key_self_link": "",
                "mode": "READ_WRITE",
                "source": "https://www.googleapis.com/compute/v1/projects/todo-er/zones/europe-west1-d/disks/puppet"
              }
            ],
            "can_ip_forward": false,
            "cpu_platform": "Intel Haswell",
            "current_status": "RUNNING",
            "deletion_protection": false,
            "description": "",
            "desired_status": null,
            "enable_display": false,
            "guest_accelerator": [],
            "hostname": "",
            "id": "projects/todo-er/zones/europe-west1-d/instances/puppet",
            "instance_id": "8479983969291051161",
            "label_fingerprint": "42WmSpB8rSM=",
            "labels": null,
            "machine_type": "n1-standard-1",
            "metadata": null,
            "metadata_fingerprint": "GEVEu9G9MiQ=",
            "metadata_startup_script": "#! /bin/bash\n\n\nyum install epel-release -y;\nyum install ansible -y;\nrpm -Uvh https://yum.puppet.com/puppet/puppet-release-el-7.noarch.rpm;\nyum install puppetserver -y;\nyum install bind-utils -y;\nsystemctl enable --now puppet;\nsystemctl enable --now puppetserver;\necho \"export PATH=/opt/puppetlabs/bin:$PATH\" \u003e\u003e .bash_profile;\nsource .bash_profile\n\necho \"10.20.0.3 puppet-host-ubuntu\" \u003e\u003e /etc/hosts;\necho \"10.20.0.4 puppet-host-centos\" \u003e\u003e /etc/hosts;\npuppet config set dns_alt_names \"puppet\" --section main;\npuppet config set server 'puppet' --section main\n\nyum install nginx -y;\nsystemctl enable --now nginx;\n\nuntil curl puppet-host-centos; do echo waiting for myservice; sleep 3; done\nuntil curl puppet-host-ubuntu; do echo waiting for myservice; sleep 3; done\npuppetserver ca list \u003e\u003e /certs.txt\n\n# /opt/puppetlabs/bin/puppetserver ca setup;\n\npuppetserver ca sign --certname puppet-host-ubuntu.c.todo-er.internal,puppet-host-centos.c.todo-er.internal\n\nuseradd -G wheel ansible -m;\necho ansible | passwd --stdin ansible;\nsed -i 's/PasswordAuthentication yes/PasswordAuthentication no/' /etc/ssh/sshd_config;\n\nmkdir /home/ansible/.ssh;\nchmod 700 /home/ansible/.ssh;\nssh-keygen -t rsa -b 2048 -f /home/ansible/.ssh/id_ansible -C ansible;\ncp home/ansible/.ssh/id_ansible* /etc/;\ncat 'eval $(ssh-agent)' \u003e\u003e /home/ansible/.bashrc;\ncat 'ssh-add /home/ansible/.ssh/id_ansible' \u003e\u003e /home/ansible/.bashrc;\nsource /home/ansible/.bashrc;\n\n\ncd /etc/puppetlabs/code/environments/production/manifests;\ncat \u003e\u003e testconfig.pp \u003c\u003cEOF\nclass nginxconfig {\n  package {\"vsftpd\":\n    ensure =\u003e installed,\n  }\n  service {\"vsftpd\":\n    enable =\u003e true,\n    #start =\u003e true\n  }\n}\n\ninclude nginxconfig\nEOF\n\ncat \u003e\u003e copysshkey.pp \u003c\u003cEOF\nclass copy_ssh {\n  file {'/home/ansible/.ssh/authorized_keys':\n    content =\u003e 'ANSIBLE_SSH_KEY'\n  }\n}\n\ninclude copy_ssh\nEOF\n\nsed -i \"s|ANSIBLE_SSH_KEY|$(cat /home/ansible/.ssh/id_ansible.pub)|\" copysshkey.pp;\n\npuppet apply testconfig.pp\npuppet apply copysshkey.pp\n# set server as ansible controller\n# until ssh-copy-id -i ansible.pub ansible@puppet-host-centos; do echo waiting for centos host to be ready; sleep 3; done;\n# until ssh-copy-id -i ansible.pub ansible@puppet-host-ubuntu; do echo waiting for ubuntu host to be ready; sleep 3; done;\n\ncat \u003e\u003e /home/ansible/inventory \u003c\u003cEOF\npuppet-host-ubuntu\npuppet-host-centos\n\nEOF\n\ncat \u003e\u003e /home/ansible/ansible.cfg \u003c\u003cEOF\n[default]\nroot_user = ansible\nhost_key_checking = false\ninventory = inventory\n\n[privilege_escalation]\nbecome = True\nbecome_method = sudo\nbecome_user = root\nbecome_ask_pass = False\n\nEOF\n\nansible all -i inventory -m shell -a 'whoami' \u00262\u003e /etc/ansible_answer.txt\n\n# Automatically accept ssh fingerprint\n# ssh -o \"StrictHostKeyChecking no\" 192.168.1.5\n",
            "min_cpu_platform": "",
            "name": "puppet",
            "network_interface": [
              {
                "access_config": [
                  {
                    "nat_ip": "35.241.178.24",
                    "network_tier": "PREMIUM",
                    "public_ptr_domain_name": ""
                  }
                ],
                "alias_ip_range": [],
                "name": "nic0",
                "network": "https://www.googleapis.com/compute/v1/projects/todo-er/global/networks/puppet-course-net",
                "network_ip": "10.20.0.2",
                "subnetwork": "https://www.googleapis.com/compute/v1/projects/todo-er/regions/europe-west1/subnetworks/subnet-europe-west1",
                "subnetwork_project": "todo-er"
              }
            ],
            "project": "todo-er",
            "resource_policies": null,
            "scheduling": [
              {
                "automatic_restart": true,
                "node_affinities": [],
                "on_host_maintenance": "MIGRATE",
                "preemptible": false
              }
            ],
            "scratch_disk": [],
            "self_link": "https://www.googleapis.com/compute/v1/projects/todo-er/zones/europe-west1-d/instances/puppet",
            "service_account": [],
            "shielded_instance_config": [
              {
                "enable_integrity_monitoring": true,
                "enable_secure_boot": false,
                "enable_vtpm": true
              }
            ],
            "tags": null,
            "tags_fingerprint": "42WmSpB8rSM=",
            "timeouts": null,
            "zone": "europe-west1-d"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH0sInNjaGVtYV92ZXJzaW9uIjoiNiJ9",
          "dependencies": [
            "google_compute_address.master-ip-address",
            "google_compute_network.puppet-course-net",
            "google_compute_subnetwork.subnet-europe-west1"
          ]
        }
      ]
    },
    {
      "module": "module.puppet-host-centos",
      "mode": "managed",
      "type": "google_compute_instance",
      "name": "vm_instance",
      "provider": "provider.google",
      "instances": [
        {
          "schema_version": 6,
          "attributes": {
            "allow_stopping_for_update": null,
            "attached_disk": [],
            "boot_disk": [
              {
                "auto_delete": true,
                "device_name": "persistent-disk-0",
                "disk_encryption_key_raw": "",
                "disk_encryption_key_sha256": "",
                "initialize_params": [
                  {
                    "image": "https://www.googleapis.com/compute/v1/projects/centos-cloud/global/images/centos-8-v20210217",
                    "labels": {},
                    "size": 20,
                    "type": "pd-standard"
                  }
                ],
                "kms_key_self_link": "",
                "mode": "READ_WRITE",
                "source": "https://www.googleapis.com/compute/v1/projects/todo-er/zones/europe-west1-d/disks/puppet-host-centos"
              }
            ],
            "can_ip_forward": false,
            "cpu_platform": "Intel Haswell",
            "current_status": "RUNNING",
            "deletion_protection": false,
            "description": "",
            "desired_status": null,
            "enable_display": false,
            "guest_accelerator": [],
            "hostname": "",
            "id": "projects/todo-er/zones/europe-west1-d/instances/puppet-host-centos",
            "instance_id": "3432613522009858201",
            "label_fingerprint": "42WmSpB8rSM=",
            "labels": null,
            "machine_type": "n1-standard-1",
            "metadata": null,
            "metadata_fingerprint": "kJESc-zEjIw=",
            "metadata_startup_script": "#! /bin/bash\n\nrpm -Uvh https://yum.puppet.com/puppet/puppet-release-el-7.noarch.rpm;\nyum install puppet-agent -y\nyum install bind-utils -y;\necho \"export PATH=/opt/puppetlabs/bin:$PATH\" \u003e\u003e .bash_profile;\nsource .bash_profile;\necho '10.20.0.2   puppet' \u003e\u003e /etc/hosts\npuppet config set server 'puppet' --section main;\npuppet resource service puppet ensure=running enable=true;\n\nuntil curl http://10.20.0.2; do echo waiting for master to be ready; sleep 3; done\npuppet agent -t;\n\nyum install nginx -y;\nsystemctl enable --now nginx\n\n# until nslookup puppet; do echo waiting for myservice; sleep 3; done\n\nsleep 60s;\npuppet agent -t;\nsystemctl status vsftpd;\n\n# add ansible user and password\nyum install epel-release -y;\nyum install ansible -y;\nuseradd -G wheel ansible -m;\necho ansible | passwd --stdin ansible;\nsed -i 's/PasswordAuthentication yes/PasswordAuthentication no/' /etc/ssh/sshd_config;\n\nmkdir /home/ansible/.ssh;\ntouch /home/ansible/.ssh/authorized_keys;\nchmod 600 /home/ansible/.ssh/authorized_keys;\nchmod 700 /home/ansible/.ssh;\nchown ansible /home/ansible/.ssh;\nchown ansible /home/ansible/.ssh/authorized_keys;\n\n",
            "min_cpu_platform": "",
            "name": "puppet-host-centos",
            "network_interface": [
              {
                "access_config": [
                  {
                    "nat_ip": "35.240.38.98",
                    "network_tier": "PREMIUM",
                    "public_ptr_domain_name": ""
                  }
                ],
                "alias_ip_range": [],
                "name": "nic0",
                "network": "https://www.googleapis.com/compute/v1/projects/todo-er/global/networks/puppet-course-net",
                "network_ip": "10.20.0.4",
                "subnetwork": "https://www.googleapis.com/compute/v1/projects/todo-er/regions/europe-west1/subnetworks/subnet-europe-west1",
                "subnetwork_project": "todo-er"
              }
            ],
            "project": "todo-er",
            "resource_policies": null,
            "scheduling": [
              {
                "automatic_restart": true,
                "node_affinities": [],
                "on_host_maintenance": "MIGRATE",
                "preemptible": false
              }
            ],
            "scratch_disk": [],
            "self_link": "https://www.googleapis.com/compute/v1/projects/todo-er/zones/europe-west1-d/instances/puppet-host-centos",
            "service_account": [],
            "shielded_instance_config": [
              {
                "enable_integrity_monitoring": true,
                "enable_secure_boot": false,
                "enable_vtpm": true
              }
            ],
            "tags": null,
            "tags_fingerprint": "42WmSpB8rSM=",
            "timeouts": null,
            "zone": "europe-west1-d"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH0sInNjaGVtYV92ZXJzaW9uIjoiNiJ9",
          "dependencies": [
            "google_compute_address.centos-ip-address",
            "google_compute_network.puppet-course-net",
            "google_compute_subnetwork.subnet-europe-west1"
          ]
        }
      ]
    },
    {
      "module": "module.jenkins-server",
      "mode": "managed",
      "type": "google_compute_instance",
      "name": "vm_instance",
      "provider": "provider.google",
      "instances": [
        {
          "schema_version": 6,
          "attributes": {
            "allow_stopping_for_update": null,
            "attached_disk": [],
            "boot_disk": [
              {
                "auto_delete": true,
                "device_name": "persistent-disk-0",
                "disk_encryption_key_raw": "",
                "disk_encryption_key_sha256": "",
                "initialize_params": [
                  {
                    "image": "https://www.googleapis.com/compute/v1/projects/ubuntu-os-cloud/global/images/ubuntu-1804-bionic-v20210211",
                    "labels": {},
                    "size": 10,
                    "type": "pd-standard"
                  }
                ],
                "kms_key_self_link": "",
                "mode": "READ_WRITE",
                "source": "https://www.googleapis.com/compute/v1/projects/todo-er/zones/europe-west2-b/disks/jenkins-server"
              }
            ],
            "can_ip_forward": false,
            "cpu_platform": "Intel Broadwell",
            "current_status": "RUNNING",
            "deletion_protection": false,
            "description": "",
            "desired_status": null,
            "enable_display": false,
            "guest_accelerator": [],
            "hostname": "",
            "id": "projects/todo-er/zones/europe-west2-b/instances/jenkins-server",
            "instance_id": "4793441873586397294",
            "label_fingerprint": "42WmSpB8rSM=",
            "labels": null,
            "machine_type": "n1-standard-1",
            "metadata": null,
            "metadata_fingerprint": "sCZh6wF1fcc=",
            "metadata_startup_script": "#! /bin/bash\n\nwget https://apt.puppetlabs.com/puppet-release-bionic.deb;\ndpkg -i puppet-release-bionic.deb;\napt update;\napt install puppet-agent -y;\necho \"export PATH=/opt/puppetlabs/bin:$PATH\" \u003e\u003e ~/.profile\nsource ~/.profile;\necho '10.20.0.2   puppet' \u003e\u003e /etc/hosts\npuppet config set server 'puppet' --section main;\npuppet resource service puppet ensure=running enable=true;\n\n\nuntil curl http://10.20.0.2; do echo waiting for master to be ready; sleep 3; done\n# until nslookup puppet; do echo waiting for myservice; sleep 3; done\npuppet agent -t;\n\napt install nginx -y;\nsystemctl enable --now nginx;\nsleep 60s;\npuppet agent -t;\nsystemctl status vsftpdd;\n\napt install ansible -y;\nuseradd -G admin ansible -m;\necho \"ansible:ansible\" | chpasswd;\n# echo ansible | passwd --stdin ansible; # works on centos\nsed -i 's/PasswordAuthentication yes/PasswordAuthentication no/' /etc/ssh/sshd_config;\n\nmkdir /home/ansible/.ssh;\ntouch /home/ansible/.ssh/authorized_keys;\nchmod 600 /home/ansible/.ssh/authorized_keys;\nchmod 700 /home/ansible/.ssh;\nchown ansible /home/ansible/.ssh;\nchown ansible /home/ansible/.ssh/authorized_keys;\n\n\nif [ $(hostname) == jenkins-server ]; then\n#   apt install java-1.8.0 -y;\n#  wget -q -O - https://pkg.jenkins.io/debian-stable/jenkins.io.key | sudo apt-key add -\n#  deb https://pkg.jenkins.io/debian-stable binary/\n#  apt-get update\n#  apt-get install jenkins\n#  apt install postgresql -y # needed to connect to db during test\n#  systemctl enable jenkins;\n#  systemctl start jenkins;\n  apt install default-jdk -y\n  apt install wget -y\n  wget -q -O - https://pkg.jenkins.io/debian/jenkins.io.key | sudo apt-key add -\n  sh -c 'echo deb http://pkg.jenkins.io/debian-stable binary/ \u003e /etc/apt/sources.list.d/jenkins.list'\n  cat /etc/apt/sources.list.d/jenkins.list\n  apt-get update;\n  apt install jenkins -y;\n  echo \"Initial admin password is $(sudo cat /var/lib/jenkins/secrets/initialAdminPassword)\"\nfi\n",
            "min_cpu_platform": "",
            "name": "jenkins-server",
            "network_interface": [
              {
                "access_config": [
                  {
                    "nat_ip": "35.197.201.79",
                    "network_tier": "PREMIUM",
                    "public_ptr_domain_name": ""
                  }
                ],
                "alias_ip_range": [],
                "name": "nic0",
                "network": "https://www.googleapis.com/compute/v1/projects/todo-er/global/networks/puppet-course-net",
                "network_ip": "10.30.0.7",
                "subnetwork": "https://www.googleapis.com/compute/v1/projects/todo-er/regions/europe-west2/subnetworks/subnet-europe-west2",
                "subnetwork_project": "todo-er"
              }
            ],
            "project": "todo-er",
            "resource_policies": null,
            "scheduling": [
              {
                "automatic_restart": true,
                "node_affinities": [],
                "on_host_maintenance": "MIGRATE",
                "preemptible": false
              }
            ],
            "scratch_disk": [],
            "self_link": "https://www.googleapis.com/compute/v1/projects/todo-er/zones/europe-west2-b/instances/jenkins-server",
            "service_account": [],
            "shielded_instance_config": [
              {
                "enable_integrity_monitoring": true,
                "enable_secure_boot": false,
                "enable_vtpm": true
              }
            ],
            "tags": null,
            "tags_fingerprint": "42WmSpB8rSM=",
            "timeouts": null,
            "zone": "europe-west2-b"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxMjAwMDAwMDAwMDAwLCJkZWxldGUiOjEyMDAwMDAwMDAwMDAsInVwZGF0ZSI6MTIwMDAwMDAwMDAwMH0sInNjaGVtYV92ZXJzaW9uIjoiNiJ9",
          "dependencies": [
            "google_compute_address.jenkins-server-ip",
            "google_compute_network.puppet-course-net",
            "google_compute_subnetwork.subnet-europe-west2"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "google_compute_network",
      "name": "puppet-course-net",
      "provider": "provider.google",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "auto_create_subnetworks": false,
            "delete_default_routes_on_create": false,
            "description": "",
            "gateway_ipv4": "",
            "id": "projects/todo-er/global/networks/puppet-course-net",
            "mtu": 0,
            "name": "puppet-course-net",
            "project": "todo-er",
            "routing_mode": "REGIONAL",
            "self_link": "https://www.googleapis.com/compute/v1/projects/todo-er/global/networks/puppet-course-net",
            "timeouts": null
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoyNDAwMDAwMDAwMDAsImRlbGV0ZSI6MjQwMDAwMDAwMDAwLCJ1cGRhdGUiOjI0MDAwMDAwMDAwMH19"
        }
      ]
    },
    {
      "mode": "managed",
      "type": "google_compute_subnetwork",
      "name": "subnet-europe-west1",
      "provider": "provider.google",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "creation_timestamp": "2021-02-22T13:13:02.974-08:00",
            "description": "",
            "fingerprint": null,
            "gateway_address": "10.20.0.1",
            "id": "projects/todo-er/regions/europe-west1/subnetworks/subnet-europe-west1",
            "ip_cidr_range": "10.20.0.0/16",
            "log_config": [],
            "name": "subnet-europe-west1",
            "network": "https://www.googleapis.com/compute/v1/projects/todo-er/global/networks/puppet-course-net",
            "private_ip_google_access": false,
            "private_ipv6_google_access": "DISABLE_GOOGLE_ACCESS",
            "project": "todo-er",
            "region": "europe-west1",
            "secondary_ip_range": [],
            "self_link": "https://www.googleapis.com/compute/v1/projects/todo-er/regions/europe-west1/subnetworks/subnet-europe-west1",
            "timeouts": null
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozNjAwMDAwMDAwMDAsImRlbGV0ZSI6MzYwMDAwMDAwMDAwLCJ1cGRhdGUiOjM2MDAwMDAwMDAwMH19",
          "dependencies": [
            "google_compute_network.puppet-course-net"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "google_compute_subnetwork",
      "name": "subnet-europe-west2",
      "provider": "provider.google",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "creation_timestamp": "2021-02-22T13:13:02.972-08:00",
            "description": "",
            "fingerprint": null,
            "gateway_address": "10.30.0.1",
            "id": "projects/todo-er/regions/europe-west2/subnetworks/subnet-europe-west2",
            "ip_cidr_range": "10.30.0.0/16",
            "log_config": [],
            "name": "subnet-europe-west2",
            "network": "https://www.googleapis.com/compute/v1/projects/todo-er/global/networks/puppet-course-net",
            "private_ip_google_access": false,
            "private_ipv6_google_access": "DISABLE_GOOGLE_ACCESS",
            "project": "todo-er",
            "region": "europe-west2",
            "secondary_ip_range": [],
            "self_link": "https://www.googleapis.com/compute/v1/projects/todo-er/regions/europe-west2/subnetworks/subnet-europe-west2",
            "timeouts": null
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjozNjAwMDAwMDAwMDAsImRlbGV0ZSI6MzYwMDAwMDAwMDAwLCJ1cGRhdGUiOjM2MDAwMDAwMDAwMH19",
          "dependencies": [
            "google_compute_network.puppet-course-net"
          ]
        }
      ]
    }
  ]
}
